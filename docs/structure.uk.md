# Структура Проєкту

FinMan використовує **Гібридну Архітектуру** для забезпечення масштабованості та чіткого розділення відповідальності.
Проєкт суворо відокремлює **Клієнтську логіку** (Браузер, IndexedDB, React) від **Серверної логіки** (Node.js, PostgreSQL), використовуючи спільний шар контрактів.

## Загальний огляд

Папка `src` поділена на чотири основні шари:

* **`app/`**: **Маршрутизація**. Тільки файли Next.js.
* **`client/`**: **Фронтенд**. Дотримується принципів **Feature-Sliced Design (FSD)**.
* **`server/`**: **Бекенд**. Дотримується принципів **Domain-Driven Design (DDD)**.
* **`common/`**: **Спільні Контракти**. Типи, Інтерфейси, Рекорди. **Жодної** бізнес-логіки.

---

## 1. Термінологія та Моделі Даних

Щоб уникнути плутанини:

| Термін | Розташування | Відповідальність | Приклад |
| :--- | :--- | :--- | :--- |
| **Record (Запис)** | `common/records/` | **Форма БД**. Чисті інтерфейси, структура таблиць 1-в-1. Спільні для FE та BE. | `UserRecord`, `BudgetPlanRecord` |
| **Entity (FE)** | `client/entities/` | **FSD Слайс**. Модуль, що містить UI, Store та доступ до даних. | `client/entities/budget-plan/` |
| **Entity (BE)** | `server/entities/` | **DDD Клас**. Клас із методами та поведінкою на сервері. | Клас `UserOrm` |
| **DTO** | `common/models/` | **Data Transfer Object**. Контракти для API (якщо відрізняються від Record). | `CreateUserDto` |

---

## 2. Директорія Client (`src/client`)
**Архітектура:** Feature-Sliced Design (FSD).

### Основна Структура
* **`widgets/`**: Незалежні UI блоки.
* **`features/`**: Сценарії користувача (наприклад, `RegistrationPage`).
* **`database/`**: **Глобальна Інфраструктура**. Містить інстанс Dexie.js та конфіг БД. *Тут немає бізнес-логіки.*
* **`entities/`**: **Бізнес-сутності (FSD Слайси)**.
  Тут живе основна логіка. Кожна папка сутності (наприклад, `budget-plan`) використовує патерн **Co-location (Об'єднання)**:

    ```text
    src/client/entities/budget-plan/
    ├── ui/                             # Компоненти (Візуал)
    │   ├── budget-card.tsx             # "Тупі" компоненти, отримують дані через пропси/хуки
    │   └── budget-list.tsx
    │
    │── budget.store.ts                 # Zustand стор
    │── budget.hook.ts                  # Кастомні хуки, що з'єднують Data та Store
    │
    └── data/                           # Шар Доступу до Даних (Руки)
        ├── budget.repository.ts        # Фасад: Перемикає між API та Локальною БД
        ├── budget.api.client.ts        # Клієнт Axios/Fetch
        └── budget.local.repository.ts  # Клієнт IndexedDB (використовує global database/)
    ```
* **`shared/`**: Перевикористовуваний інфраструктурний код (компоненти, хуки, утиліти).

---

## 3. Директорія Server (`src/server`)
**Архітектура:** Domain-Driven Design (DDD).

### Структура
* **`entities/`**: **Shared Kernel (Спільне Ядро)**.
    * Спільні бізнес-класи (наприклад, `UserOrm`).
    * Містять чисту бізнес-логіку.
    * Використовують `Records` з `common/` як внутрішній стан.
* **`features/`**: Ізольовані бізнес-модулі.
    * **`domain/`**: Локальні правила та сутності.
    * **`application/`**: Use Cases, Сервіси.
    * **`infrastructure/`**: Робота з БД та API.

---

## 4. Директорія Common (`src/common`)
**Призначення:** Чиста типізація.

* **`records/`**: **Джерело правди.** Визначення таблиць БД (наприклад, `BudgetPlanRecord`).
* **`models/`**: Спільні DTO.
* **`constants/`** та **`utils/`**: Константи та чисті функції.
* **`utils/`**: Спільні утиліти (тільки чистий JS/TS).
---

## Правила Залежностей (Суворі)

Щоб зберегти модульність і запобігти циклічним залежностям, необхідно дотримуватися наступних правил імпорту:

1.  **Клієнт проти Сервера (Абсолютний бар'єр):**
    * `client/` **ЗАБОРОНЕНО** імпортувати з `server/`.
    * `server/` **ЗАБОРОНЕНО** імпортувати з `client/`.
    * **Виняток:** Обидва шари взаємодіють тільки через API (HTTP) і використовують спільні контракти з `common/`.

2.  **Шар Common (Фундамент):**
    * `common/` **ЗАБОРОНЕНО** імпортувати будь-що з `client/` або `server/`.
    * Він повинен залишатися чистим (Типи, Рекорди, Константи, Утиліти).

3.  **Records проти Entities (Дані проти Поведінки):**
    * `server/entities` (DDD Класи) залежать від `common/records` (Форма даних).
    * `client/entities` (FSD Слайси) залежать від `common/records` (Форма даних).

4.  **Клієнтська частина (Ієрархія FSD):**
    * Правило: **"Можна імпортувати тільки знизу"**.
    * `app` -> імпортує `widgets`, `features`, `entities`, `shared`.
    * `widgets` -> імпортують `features`, `entities`, `shared`.
    * `features` -> імпортують `entities`, `shared`. (**Не можуть** імпортувати інші фічі).
    * `entities` -> імпортують `shared`, `repositories`, `database`. (**Не можуть** імпортувати інші сутності).
    * `shared` -> нічого не імпортує з верхніх шарів.

5.  **Серверна частина (DDD та Модульність):**
    * **Shared Kernel:** Фічі (`server/features/*`) **МОЖУТЬ** імпортувати з `server/entities` (Спільні сутності) та `server/shared`.
    * **Ізоляція Фіч:** Одна фіча (наприклад, `budget`) **НЕ ПОВИННА** напряму імпортувати код з іншої фічі (наприклад, `auth`).
    * **Шари DDD:**
        * `infrastructure` залежить від `domain` та `application`.
        * `application` залежить від `domain`.
        * `domain` є **незалежним** (залежить тільки від `common/` та `server/entities`).